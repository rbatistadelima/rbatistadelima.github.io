<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🎤 Legenda Ao Vivo HD</title>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background: #000;
  color: white;
  overflow: hidden;
}
#controls {
  position: absolute;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  background: rgba(0,0,0,0.7);
  padding: 8px;
  border-radius: 15px;
  z-index: 10;
}
#controls label, #controls select, #controls input, #controls button {
  margin: 5px;
  font-size: 1em;
}
select#fontFamily option {
  font-size: 1.2em;
}
#output {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  padding: 20px;
  width: 100%;
}
.line {
  display: inline-block;
  margin: 2px 0; /* menor distância entre linhas */
  padding: 12px 25px;
  border-radius: 25px;
  max-width: 90%;
  line-height: 1.2em;
  word-wrap: break-word;
  color: white;
  background: rgba(0,0,0,0.7); /* fundo escuro sólido */
  text-shadow: 
    -2px -2px 0 #000,
     2px -2px 0 #000,
    -2px 2px 0 #000,
     2px 2px 0 #000; /* borda das letras */
}
.previous {
  opacity: 0.5;
}
</style>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@600&family=Oswald:wght@600&family=Roboto:wght@500&family=Lato&family=Raleway&family=PT+Sans&family=Nunito&family=Open+Sans&family=Ubuntu&display=swap" rel="stylesheet">
</head>
<body>
<div id="controls">
  <button id="toggleBtn">🎧 Clique para Iniciar</button>
  <label>Microfone:</label>
  <select id="micSelect"></select>
  <label>Fundo:</label>
  <select id="bgColor">
    <option value="#000000">Preto</option>
    <option value="#00ff00">Verde (Chroma)</option>
  </select>
  <label>Fonte:</label>
  <select id="fontFamily">
    <option value="Arial">Arial</option>
    <option value="Verdana">Verdana</option>
    <option value="Impact">Impact</option>
    <option value="Courier New">Courier New</option>
    <option value="Times New Roman">Times New Roman</option>
    <option value="Comic Sans MS">Comic Sans MS</option>
    <option value="Roboto">Roboto</option>
    <option value="Oswald">Oswald</option>
    <option value="Montserrat">Montserrat</option>
    <option value="Bebas Neue">Bebas Neue</option>
    <option value="Lato">Lato</option>
    <option value="Raleway">Raleway</option>
    <option value="PT Sans">PT Sans</option>
    <option value="Nunito">Nunito</option>
    <option value="Open Sans">Open Sans</option>
    <option value="Ubuntu">Ubuntu</option>
  </select>
  <label>Tamanho:</label>
  <input type="number" id="fontSize" value="2.5" step="0.1" min="1" max="8">em
  <label>Grossura Borda:</label>
  <input type="number" id="borderWidth" value="2" step="1" min="1" max="10">px
</div>

<div id="output">
  <div class="line previous"></div>
  <div class="line current">🎧 Clique para Iniciar</div>
</div>

<script>
let recognition;
let listening = false;
let previousText = "";
let currentText = "";
let interimText = "";
let selectedMicId = null;

const toggleBtn = document.getElementById("toggleBtn");
const micSelect = document.getElementById("micSelect");
const prevLine = document.querySelector(".previous");
const currLine = document.querySelector(".current");

async function loadMicrophones() {
  const devices = await navigator.mediaDevices.enumerateDevices();
  micSelect.innerHTML = "";
  devices.filter(d => d.kind === "audioinput").forEach((device,i)=>{
    const opt=document.createElement("option");
    const parts=device.label.split(" ");
    if(parts.length>1){
      opt.innerHTML=`<b>${parts[0]}</b> ${parts.slice(1).join(" ")}`;
    } else opt.innerHTML=device.label;
    opt.value=device.deviceId;
    micSelect.appendChild(opt);
  });
}
navigator.mediaDevices.getUserMedia({audio:true}).then(loadMicrophones).catch(()=>{currLine.textContent="⚠️ Permita o uso do microfone";});

function applySettings(){
  const bgColor=document.getElementById("bgColor").value;
  const fontFamily=document.getElementById("fontFamily").value;
  const fontSize=document.getElementById("fontSize").value;
  const borderWidth=document.getElementById("borderWidth").value;

  document.body.style.background=bgColor;
  [prevLine,currLine].forEach(line=>{
    line.style.fontFamily=fontFamily;
    line.style.fontSize=fontSize+"em";
    line.style.textShadow=`
      -${borderWidth}px -${borderWidth}px 0 #000,
       ${borderWidth}px -${borderWidth}px 0 #000,
      -${borderWidth}px ${borderWidth}px 0 #000,
       ${borderWidth}px ${borderWidth}px 0 #000
    `;
    line.style.background="rgba(0,0,0,0.7)";
  });
}
applySettings();

function updateDisplay(isFinal=false){
  currLine.textContent=isFinal?currentText:interimText;
  if(previousText) prevLine.textContent=previousText;
  applySettings();
}

if('webkitSpeechRecognition' in window){
  recognition=new webkitSpeechRecognition();
  recognition.lang='pt-BR';
  recognition.continuous=true;
  recognition.interimResults=true;

  recognition.onresult=(event)=>{
    let interim="";
    for(let i=event.resultIndex;i<event.results.length;i++){
      const txt=event.results[i][0].transcript.trim();
      if(event.results[i].isFinal){
        previousText=currentText;
        currentText=txt;
        interimText="";
        updateDisplay(true);
      } else interim=txt;
    }
    if(interim){
      interimText=interim;
      updateDisplay(false);
    }
  };

  recognition.onerror=(e)=>{
    if(["no-speech","aborted","audio-capture"].includes(e.error)) return;
    currLine.textContent="⚠️ Erro: "+e.error;
  };

  recognition.onend=()=>{if(listening) recognition.start();}
} else {currLine.textContent="❌ Navegador não suporta SpeechRecognition";}

async function toggleListening(){
  if(!listening){
    try{
      selectedMicId=micSelect.value;
      await navigator.mediaDevices.getUserMedia({audio:{deviceId:selectedMicId?{exact:selectedMicId}:undefined}});
      recognition.start();
      listening=true;
      toggleBtn.textContent="⏹️ Parar";
      currLine.textContent="🎧 Ouvindo...";
    } catch{
      currLine.textContent="⚠️ Permita o uso do microfone";
    }
  } else {
    listening=false;
    recognition.stop();
    toggleBtn.textContent="🎧 Clique para Iniciar";
    currLine.textContent="⏸️ Parado";
  }
}

toggleBtn.onclick=toggleListening;
currLine.onclick=toggleListening; // clicando em Parado também inicia

document.querySelectorAll("#controls input,#controls select").forEach(el=>el.addEventListener("input",applySettings));
</script>
</body>
</html>

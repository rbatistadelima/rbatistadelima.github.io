<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Stylophone 1968 Replica</title>
<style>
  html, body {
    margin: 0;
    height: 100%;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    touch-action: none;
  }

  .stylophone {
    position: relative;
    width: 95vw;
    max-width: 700px;
    height: 160px;
    background: linear-gradient(145deg, #222 0%, #000 100%);
    border-radius: 10px;
    border: 3px solid #555;
    box-shadow: inset 0 0 15px #000, 0 4px 10px #000;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .grid {
    display: flex;
    width: 90%;
    height: 60%;
    background: linear-gradient(180deg, #bbb, #777);
    border-radius: 4px;
    overflow: hidden;
    box-shadow: inset 0 0 8px #000a;
  }

  .pad {
    flex: 1;
    border-left: 1px solid #111;
    border-right: 1px solid #333;
    background: linear-gradient(180deg, #ccc 0%, #888 100%);
    position: relative;
    transition: background 0.05s;
  }

  .pad.active {
    background: linear-gradient(180deg, #0f0, #090);
  }

  .pad::after {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    bottom: 2px;
    height: 2px;
    background: #333;
  }

  .stylus {
    position: absolute;
    width: 8px;
    height: 80px;
    background: linear-gradient(#ccc, #777);
    border-radius: 4px;
    box-shadow: 0 0 6px #000;
    transform-origin: bottom center;
    pointer-events: none;
    transition: transform 0.05s;
  }
</style>
</head>
<body>

<div class="stylophone">
  <div class="grid"></div>
  <div class="stylus"></div>
</div>

<script>
const ctx = new (window.AudioContext || window.webkitAudioContext)();
let osc = null, gain = null, currentPad = null;

const grid = document.querySelector('.grid');
const stylus = document.querySelector('.stylus');

// 20 keys, C3 (130.81 Hz) to E4 (329.63 Hz)
const freqs = [
  130.81, 138.59, 146.83, 155.56, 164.81,
  174.61, 185.00, 196.00, 207.65, 220.00,
  233.08, 246.94, 261.63, 277.18, 293.66,
  311.13, 329.63, 349.23, 369.99, 392.00
];

freqs.forEach(f => {
  const p = document.createElement('div');
  p.className = 'pad';
  p.dataset.freq = f;
  grid.appendChild(p);
});

function startSound(freq) {
  stopSound();
  osc = ctx.createOscillator();
  gain = ctx.createGain();
  osc.type = 'square';
  osc.frequency.value = freq;
  gain.gain.value = 0.2;
  osc.connect(gain);
  gain.connect(ctx.destination);
  osc.start();
}

function stopSound() {
  if (osc) {
    osc.stop();
    osc.disconnect();
    gain.disconnect();
    osc = null;
    gain = null;
  }
}

function padFromEvent(e) {
  const t = e.touches ? e.touches[0] : e;
  const el = document.elementFromPoint(t.clientX, t.clientY);
  return el && el.classList.contains('pad') ? el : null;
}

function handleMove(e) {
  const pad = padFromEvent(e);
  if (pad && pad !== currentPad) {
    if (currentPad) currentPad.classList.remove('active');
    currentPad = pad;
    pad.classList.add('active');
    startSound(parseFloat(pad.dataset.freq));
  }
  const t = e.touches ? e.touches[0] : e;
  stylus.style.left = t.clientX - 4 + 'px';
  stylus.style.top = t.clientY - 70 + 'px';
}

function handleEnd() {
  if (currentPad) currentPad.classList.remove('active');
  currentPad = null;
  stopSound();
}

document.addEventListener('touchstart', handleMove, {passive:false});
document.addEventListener('touchmove', handleMove, {passive:false});
document.addEventListener('touchend', handleEnd);
document.addEventListener('mousedown', handleMove);
document.addEventListener('mousemove', e => { if (e.buttons) handleMove(e); });
document.addEventListener('mouseup', handleEnd);
</script>

</body>
</html>

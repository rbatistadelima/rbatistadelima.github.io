<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üé§ Legenda ao Vivo Pro+</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    height: 100vh;
    background: #000;
    color: white;
    overflow: hidden;
  }
  #controls {
    width: 100%;
    padding: 8px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    background: rgba(0,0,0,0.7);
  }
  #controls label, #controls select, #controls input, #controls button {
    margin: 5px;
    font-size: 1em;
  }
  select#fontFamily option {
    font-size: 1.2em;
  }
  select#fontFamily option[value="Impact"] { font-family: Impact, sans-serif; }
  select#fontFamily option[value="Arial"] { font-family: Arial, sans-serif; }
  select#fontFamily option[value="Verdana"] { font-family: Verdana, sans-serif; }
  select#fontFamily option[value="Courier New"] { font-family: "Courier New", monospace; }
  select#fontFamily option[value="Times New Roman"] { font-family: "Times New Roman", serif; }
  select#fontFamily option[value="Comic Sans MS"] { font-family: "Comic Sans MS", cursive; }
  select#fontFamily option[value="Roboto"] { font-family: "Roboto", sans-serif; }
  select#fontFamily option[value="Oswald"] { font-family: "Oswald", sans-serif; }
  select#fontFamily option[value="Montserrat"] { font-family: "Montserrat", sans-serif; }
  select#fontFamily option[value="Bebas Neue"] { font-family: "Bebas Neue", sans-serif; }
  #output {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    align-items: center;
    text-align: center;
    padding: 20px;
    width: 100%;
  }
  .line {
    display: inline-block;
    margin: 6px 0;
    padding: 12px 20px;
    border-radius: 20px;
    max-width: 90%;
    line-height: 1.4em;
    word-wrap: break-word;
    color: white;
    background: rgba(0, 0, 0, 0.6);
    text-shadow:
      -2px -2px 0 #000,
       2px -2px 0 #000,
      -2px  2px 0 #000,
       2px  2px 0 #000;
  }
  .previous {
    opacity: 0.4;
  }

  /* Importar fontes extras do Google Fonts */
  @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@600&family=Oswald:wght@600&family=Roboto:wght@500&display=swap');
</style>
</head>
<body>
  <div id="controls">
    <button id="toggleBtn">‚ñ∂Ô∏è Iniciar</button>
    <label>üéôÔ∏è Microfone:</label>
    <select id="micSelect"></select>
    <label>üé® Fundo:</label>
    <select id="bgColor">
      <option value="#000000">Preto</option>
      <option value="#00ff00">Verde (Chroma)</option>
    </select>
    <label>üÖ∞Ô∏è Fonte:</label>
    <select id="fontFamily">
      <option value="Arial">Arial</option>
      <option value="Verdana">Verdana</option>
      <option value="Impact">Impact</option>
      <option value="Courier New">Courier New</option>
      <option value="Times New Roman">Times New Roman</option>
      <option value="Comic Sans MS">Comic Sans MS</option>
      <option value="Roboto">Roboto</option>
      <option value="Oswald">Oswald</option>
      <option value="Montserrat">Montserrat</option>
      <option value="Bebas Neue">Bebas Neue</option>
    </select>
    <label>üî† Tamanho:</label>
    <input type="number" id="fontSize" value="2.5" step="0.1" min="1" max="8">em
    <label>‚¨õ Borda:</label>
    <input type="color" id="borderColor" value="#000000">
  </div>

  <div id="output">
    <div class="line previous"></div>
    <div class="line current">üéß Clique em Iniciar</div>
  </div>

<script>
let recognition;
let listening = false;
let previousText = "";
let currentText = "";
let interimText = "";
let selectedMicId = null;

const toggleBtn = document.getElementById("toggleBtn");
const micSelect = document.getElementById("micSelect");
const prevLine = document.querySelector(".previous");
const currLine = document.querySelector(".current");

// üîä Listar microfones dispon√≠veis
async function loadMicrophones() {
  const devices = await navigator.mediaDevices.enumerateDevices();
  micSelect.innerHTML = "";
  devices.filter(d => d.kind === "audioinput").forEach((device, i) => {
    const opt = document.createElement("option");
    opt.value = device.deviceId;
    opt.textContent = device.label || `Microfone ${i+1}`;
    micSelect.appendChild(opt);
  });
}

navigator.mediaDevices.getUserMedia({audio: true})
  .then(loadMicrophones)
  .catch(() => { currLine.textContent = "‚ö†Ô∏è Permita o uso do microfone."; });

function applySettings() {
  const bgColor = document.getElementById("bgColor").value;
  const fontFamily = document.getElementById("fontFamily").value;
  const fontSize = document.getElementById("fontSize").value;
  const borderColor = document.getElementById("borderColor").value;

  document.body.style.background = bgColor;
  [prevLine, currLine].forEach(line => {
    line.style.fontFamily = fontFamily;
    line.style.fontSize = fontSize + "em";
    line.style.textShadow = `
      -2px -2px 0 ${borderColor},
       2px -2px 0 ${borderColor},
      -2px  2px 0 ${borderColor},
       2px  2px 0 ${borderColor}
    `;
    line.style.background = bgColor;
  });
}

applySettings();

function updateDisplay(isFinal = false) {
  const textToShow = isFinal ? currentText.toUpperCase() : interimText.toLowerCase();
  currLine.textContent = textToShow;
  if (previousText) prevLine.textContent = previousText.toUpperCase();
  applySettings();
}

if ('webkitSpeechRecognition' in window) {
  recognition = new webkitSpeechRecognition();
  recognition.lang = 'pt-BR';
  recognition.continuous = true;
  recognition.interimResults = true;

  recognition.onresult = (event) => {
    let interim = "";
    for (let i = event.resultIndex; i < event.results.length; ++i) {
      const txt = event.results[i][0].transcript.trim();
      if (event.results[i].isFinal) {
        if (txt.length > 22) {
          previousText = txt.slice(0, 22);
          currentText = txt.slice(22);
        } else {
          previousText = currentText;
          currentText = txt;
        }
        interimText = "";
        updateDisplay(true);
      } else {
        interim = txt;
      }
    }
    if (interim) {
      interimText = interim;
      updateDisplay(false);
    }
  };

  recognition.onerror = (e) => {
    if (["no-speech", "aborted", "audio-capture"].includes(e.error)) return;
    currLine.textContent = "‚ö†Ô∏è Erro: " + e.error;
  };

  recognition.onend = () => { if (listening) recognition.start(); };
} else {
  currLine.textContent = "‚ùå Navegador n√£o suporta SpeechRecognition.";
}

toggleBtn.onclick = async () => {
  if (!listening) {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({
        audio: { deviceId: micSelect.value ? { exact: micSelect.value } : undefined }
      });
      recognition.start();
      listening = true;
      toggleBtn.textContent = "‚èπÔ∏è Parar";
      currLine.textContent = "üéß Ouvindo...";
    } catch {
      currLine.textContent = "‚ö†Ô∏è Permita o uso do microfone.";
    }
  } else {
    listening = false;
    recognition.stop();
    toggleBtn.textContent = "‚ñ∂Ô∏è Iniciar";
    currLine.textContent = "‚è∏Ô∏è Parado";
  }
};

document.querySelectorAll("#controls input, #controls select")
  .forEach(el => el.addEventListener("input", applySettings));
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Stylophone</title>
<style>
  html, body {
    margin: 0;
    height: 100%;
    overflow: hidden;
    background: radial-gradient(circle at 50% 20%, #222 0%, #000 100%);
    touch-action: none;
    font-family: monospace;
  }

  .stylophone {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: flex-end;
    height: 100%;
  }

  .keys {
    display: flex;
    position: relative;
    width: 95%;
    height: 70%;
    max-width: 600px;
    border: 2px solid #666;
    border-radius: 6px;
    background: #333;
    box-shadow: inset 0 0 10px #000;
  }

  .key {
    flex: 1;
    border-left: 1px solid #555;
    border-right: 1px solid #111;
    background: linear-gradient(to bottom, #eee 0%, #ccc 100%);
    display: flex;
    justify-content: center;
    align-items: flex-end;
    font-size: 0.9em;
    color: #000;
    position: relative;
    z-index: 1;
  }

  .key.black {
    position: absolute;
    width: 6%;
    height: 50%;
    top: 0;
    background: linear-gradient(to bottom, #111 0%, #444 100%);
    border: 1px solid #000;
    border-radius: 0 0 4px 4px;
    color: #fff;
    z-index: 2;
  }

  .key.active {
    background: #0f0 !important;
    color: #000;
  }

  .stylus {
    position: absolute;
    width: 8px;
    height: 80px;
    background: linear-gradient(#aaa, #666);
    border-radius: 4px;
    box-shadow: 0 0 6px #000;
    transform-origin: bottom center;
    transition: transform 0.05s;
    pointer-events: none;
  }
</style>
</head>
<body>

<div class="stylophone">
  <div class="keys"></div>
  <div class="stylus"></div>
</div>

<script>
const ctx = new (window.AudioContext || window.webkitAudioContext)();
let osc = null, gain = null;

const notes = [
  { name: 'C4', freq: 261.63 },
  { name: 'D4', freq: 293.66 },
  { name: 'E4', freq: 329.63 },
  { name: 'F4', freq: 349.23 },
  { name: 'G4', freq: 392.00 },
  { name: 'A4', freq: 440.00 },
  { name: 'B4', freq: 493.88 },
  { name: 'C5', freq: 523.25 }
];

// Relative positions of black keys (between white)
const blackKeys = [
  { pos: 0.7, name: 'C#4', freq: 277.18 },
  { pos: 1.7, name: 'D#4', freq: 311.13 },
  { pos: 3.7, name: 'F#4', freq: 369.99 },
  { pos: 4.7, name: 'G#4', freq: 415.30 },
  { pos: 5.7, name: 'A#4', freq: 466.16 },
];

const keysContainer = document.querySelector('.keys');
const stylus = document.querySelector('.stylus');

// create white keys
notes.forEach((n) => {
  const k = document.createElement('div');
  k.className = 'key white';
  k.textContent = n.name;
  k.dataset.freq = n.freq;
  keysContainer.appendChild(k);
});

// create black keys
blackKeys.forEach((b) => {
  const k = document.createElement('div');
  k.className = 'key black';
  k.textContent = b.name.replace('#','â™¯');
  k.style.left = `${(b.pos / notes.length) * 100}%`;
  k.dataset.freq = b.freq;
  keysContainer.appendChild(k);
});

let currentKey = null;

function startSound(freq) {
  stopSound();
  osc = ctx.createOscillator();
  gain = ctx.createGain();
  osc.type = 'square';
  osc.frequency.value = freq;
  gain.gain.value = 0.2;
  osc.connect(gain);
  gain.connect(ctx.destination);
  osc.start();
}

function stopSound() {
  if (osc) {
    osc.stop();
    osc.disconnect();
    gain.disconnect();
    osc = null;
    gain = null;
  }
}

function keyFromEvent(e) {
  const touch = e.touches ? e.touches[0] : e;
  const el = document.elementFromPoint(touch.clientX, touch.clientY);
  return el && el.classList.contains('key') ? el : null;
}

function handleMove(e) {
  const key = keyFromEvent(e);
  if (key && key !== currentKey) {
    if (currentKey) currentKey.classList.remove('active');
    currentKey = key;
    key.classList.add('active');
    startSound(parseFloat(key.dataset.freq));
  }
  if (e.touches) {
    const t = e.touches[0];
    stylus.style.left = t.clientX - 4 + 'px';
    stylus.style.top = t.clientY - 70 + 'px';
  } else {
    stylus.style.left = e.clientX - 4 + 'px';
    stylus.style.top = e.clientY - 70 + 'px';
  }
}

function handleEnd() {
  if (currentKey) currentKey.classList.remove('active');
  currentKey = null;
  stopSound();
}

document.addEventListener('touchstart', handleMove, {passive:false});
document.addEventListener('touchmove', handleMove, {passive:false});
document.addEventListener('touchend', handleEnd);
document.addEventListener('mousedown', handleMove);
document.addEventListener('mousemove', e => { if (e.buttons) handleMove(e); });
document.addEventListener('mouseup', handleEnd);
</script>
</body>
</html>

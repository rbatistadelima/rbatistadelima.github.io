<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üé§ Legenda ao Vivo Pro</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    height: 100vh;
    background: #000;
    color: white;
    overflow: hidden;
  }
  #controls {
    width: 100%;
    padding: 10px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    background: rgba(0,0,0,0.7);
    z-index: 10;
  }
  #controls label, #controls select, #controls input, #controls button {
    margin: 5px;
    font-size: 1em;
  }
  #output {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 20px;
    width: 100%;
    transition: background 0.4s ease;
  }
  .line {
    display: inline-block;
    margin: 5px;
    padding: 10px 20px;
    border-radius: 20px;
    line-height: 1.4em;
    word-wrap: break-word;
    max-width: 90%;
    border: 3px solid #000;
  }
  .previous {
    opacity: 0.4;
  }
  .highlight {
    color: #ff0;
  }
</style>
</head>
<body>
  <div id="controls">
    <button id="toggleBtn">‚ñ∂Ô∏è Iniciar</button>
    <label>Fundo:</label>
    <select id="bgColor">
      <option value="#000000">Preto</option>
      <option value="#00ff00">Verde (Chroma)</option>
    </select>
    <label>Mai√∫sculo:</label>
    <input type="checkbox" id="upperCase">
    <label>Fonte:</label>
    <select id="fontFamily">
      <option value="Arial">Arial</option>
      <option value="Verdana">Verdana</option>
      <option value="Impact">Impact</option>
      <option value="Courier New">Courier</option>
    </select>
    <label>Tamanho:</label>
    <input type="number" id="fontSize" value="2" step="0.2" min="1" max="6">em
    <label>Borda:</label>
    <input type="color" id="borderColor" value="#000000">
    <label>Fundo:</label>
    <select id="bgMode">
      <option value="fixed">Fixo</option>
      <option value="adaptive">Adaptativo</option>
    </select>
    <label>Duas Linhas:</label>
    <input type="checkbox" id="twoLines" checked>
  </div>

  <div id="output">
    <div class="line previous"></div>
    <div class="line current">üéß Clique em Iniciar</div>
  </div>

<script>
let recognition;
let listening = false;
let previousText = "";
let currentText = "";
const toggleBtn = document.getElementById("toggleBtn");
const output = document.getElementById("output");
const prevLine = document.querySelector(".previous");
const currLine = document.querySelector(".current");

if ('webkitSpeechRecognition' in window) {
  recognition = new webkitSpeechRecognition();
  recognition.lang = 'pt-BR';
  recognition.continuous = true;
  recognition.interimResults = true;

  recognition.onresult = (event) => {
    let interim = "";
    for (let i = event.resultIndex; i < event.results.length; ++i) {
      const txt = event.results[i][0].transcript.trim();
      if (event.results[i].isFinal) {
        previousText = currentText;
        currentText = txt;
      } else {
        interim = txt;
      }
    }
    updateDisplay((currentText + " " + interim).trim());
  };

  recognition.onerror = (e) => currLine.textContent = "‚ùå Erro: " + e.error;
  recognition.onend = () => { if (listening) recognition.start(); };
} else {
  currLine.textContent = "‚ùå Navegador n√£o suporta SpeechRecognition.";
}

function updateDisplay(text) {
  const upper = document.getElementById("upperCase").checked;
  const twoLines = document.getElementById("twoLines").checked;
  const bgMode = document.getElementById("bgMode").value;
  const fontSize = document.getElementById("fontSize").value;
  const fontFamily = document.getElementById("fontFamily").value;
  const borderColor = document.getElementById("borderColor").value;

  const bgColor = document.getElementById("bgColor").value;
  document.body.style.background = bgColor;

  if (upper) text = text.toUpperCase();
  currLine.textContent = text;
  currLine.style.fontSize = fontSize + "em";
  currLine.style.fontFamily = fontFamily;
  currLine.style.borderColor = borderColor;
  currLine.style.borderRadius = "25px";

  if (twoLines) {
    prevLine.textContent = previousText ? (upper ? previousText.toUpperCase() : previousText) : "";
    prevLine.style.display = "block";
    prevLine.style.fontFamily = fontFamily;
    prevLine.style.borderColor = borderColor;
  } else {
    prevLine.style.display = "none";
  }

  if (bgMode === "adaptive") {
    output.style.background = `linear-gradient(90deg, ${bgColor}, ${borderColor})`;
  } else {
    output.style.background = bgColor;
  }
}

toggleBtn.onclick = async () => {
  if (!listening) {
    try {
      await navigator.mediaDevices.getUserMedia({ audio: true });
      recognition.start();
      listening = true;
      toggleBtn.textContent = "‚èπÔ∏è Parar";
      currLine.textContent = "üéß Ouvindo...";
    } catch {
      currLine.textContent = "‚ö†Ô∏è Permita o uso do microfone.";
    }
  } else {
    listening = false;
    recognition.stop();
    toggleBtn.textContent = "‚ñ∂Ô∏è Iniciar";
    currLine.textContent = "‚è∏Ô∏è Parado";
  }
};
</script>
</body>
</html>
